<!-- # Отчет по лабораторной работе №1 -->
#### «Национальный исследовательский университет ИТМО»
### Основы профессиональной деятельности
## Лабораторная работа 7
## Вариант 3150
### Хабнер Георгий, P3131
###  2023

## Задание
> Синтезировать цикл исполнения для выданных преподавателем команд. Разработать тестовые программы, которые проверяют каждую из синтезированных команд. Загрузить в микропрограммную память БЭВМ циклы исполнения синтезированных команд, загрузить в основную память БЭВМ тестовые программы. Проверить и отладить разработанные тестовые программы и микропрограммы.
    1. MULSP - Беззнаковое умножение младших байтов верхних чисел на вершине стека, результат поместить на стек, установить признаки N/Z/V/C
    2. Код операции - 0F20
    3. Тестовая программа должна начинаться с адреса 03D116

## Код программы

|     Адрес МП    |     Микрокоманда    |     Описание                         |     Комментарий                                                                    |
|-----------------|---------------------|--------------------------------------|------------------------------------------------------------------------------------|
|     BB          |     81F0014002      |     if   CR(8) = 1 then GOTO @ F0    |     Исправленная ячейка интерпретатора                                             |
|     F0          |     0080009008      |     SP   -> AR                       |     Первое значение стека                                                          |
|     F1          |     0100000000      |     MEM(AR)   -> DR                  |     в DR                                                                           |
|     F2          |     0020000000      |     0->BR                            |     Очистка аккумулятора                                                           |
|     F3          |     0010A01001      |     LTOL(DR)   -> AC, N, Z, C                       |     Первое значение в AC                                                           |
|     F4          |     0080009408      |     SP +   1 -> AR                   |     Младшие разряды второго                                                        |
|     F5          |     0100001000      |     MEM(AR)   -> DR                  |     значения стека                                                                 |
|     F6          |     0001001001      |     LTOL(DR)-> DR                 |     в DR                                                                           |
|     F7          |     0010A80010      |     ASR   (AC) -> AC N,Z,C           |     Арифметический сдвиг аккумулятора   вправо, установка флагов                   |
|     F8          |     80FA011040      |     If PS(C)=0   GOTO @FA            |     Пропуск операции, если С=0                                                     |
|     F9          |     0020009021      |     BR+DR->BR                        |     Сложение старого значения BR с DR и   запись в BR                              |
|     FA          |     0001020001      |     SHL   (DR) -> DR                 |     Арифметический сдвиг DR влево                                                  |
|     FB          |     80F7041040      |     If PS(Z)=0   GOTO @F7            |     Если аккумулятор не равен 0, то   переход в начало (F7) исполнения операции    |
|     FC          |     0001E09020      |     BR->DR, N, Z, V, C                           |     Буфер в DR                                                                     |
|     FD          |     0088009208      |     ~0   + SP -> SP, AR              |     Результат выражения                                                            |
|     FE          |     0200000000      |     DR   -> MEM(AR)                  |     в стек                                                                         |
|     FF          |     80C4101040      |     GOTO   INT @ C4                  |     Переход к циклу прер.                                                          |

##Код тестовой программы
```basm
	    ORG 	0x3C9
ARG1:	WORD	0x0000
ARG2:	WORD	0xFFFF
ARG3:	WORD	0x1055
ARG4:	WORD	0x2002
CHECK:	WORD	0x0000
RES1:	WORD	0x0000
RES2:	WORD	0xFE01
RES3:	WORD	0x00AA
START:	CLA	
	CALL	TEST1
	HLT	
	CALL	TEST2
	HLT	
	CALL	TEST3
	HLT		
	LD	CHECK
                HLT
TEST1:	CLA
                LD              ARG1
                PUSH            
                PUSH            
                WORD            0x0F20
                POP             
                ST              RES1
                CMP             RES1
                BEQ             OK
                BR              NOTOK
OK:             POP
                POP
                LD              #0x1
                ADD             CHECK
                ST              CHECK
                CLA
                RET   
NOTOK:          POP
                POP
                LD              #0x0
                ADD             CHECK
                ST              CHECK
                CLA
                RET
TEST2:          CLA
                LD              ARG2
                PUSH            
                PUSH            
                WORD            0x0F20
                HLT
                POP             
                ST              RES2
                CMP             RES2
                BEQ             OK
                BR              NOTOK
TEST3:          CLA
                LD              ARG3
                PUSH            
                LD              ARG4
                PUSH            
                WORD            0x0F20
                POP             
                ST              RES3
                CMP             RES3
                BEQ             OK
                BR              NOTOK
```

##Трассировка микропрограммы

| Адр | МК         | IP  | CR   | AR  | DR   | SP  | BR   | AC   | NZVC | СчМК |
|-----|------------|-----|------|-----|------|-----|------|------|------|------|
| F0  | 0080009008 | 3FC | 0F20 | 7FA | 0F20 | 7FA | 03FB | 2002 | 0000 | F1   |
| F1  | 0100000000 | 3FC | 0F20 | 7FA | 2002 | 7FA | 03FB | 2002 | 0000 | F2   |
| F2  | 0020000000 | 3FC | 0F20 | 7FA | 2002 | 7FA | 0000 | 2002 | 0000 | F3   |
| F3  | 0010A01001 | 3FC | 0F20 | 7FA | 2002 | 7FA | 0000 | 0002 | 0000 | F4   |
| F4  | 0080009408 | 3FC | 0F20 | 7FB | 2002 | 7FA | 0000 | 0002 | 0000 | F5   |
| F5  | 0100001000 | 3FC | 0F20 | 7FB | 1055 | 7FA | 0000 | 0002 | 0000 | F6   |
| F6  | 0001001001 | 3FC | 0F20 | 7FB | 0055 | 7FA | 0000 | 0002 | 0000 | F7   |
| F7  | 0010A80010 | 3FC | 0F20 | 7FB | 0055 | 7FA | 0000 | 0001 | 0000 | F8   |
| F8  | 80FA011040 | 3FC | 0F20 | 7FB | 0055 | 7FA | 0000 | 0001 | 0000 | FA   |
| FA  | 0001020001 | 3FC | 0F20 | 7FB | 00AA | 7FA | 0000 | 0001 | 0000 | FB   |
| FB  | 80F7041040 | 3FC | 0F20 | 7FB | 00AA | 7FA | 0000 | 0001 | 0000 | F7   |
| F7  | 0010A80010 | 3FC | 0F20 | 7FB | 00AA | 7FA | 0000 | 0000 | 0101 | F8   |
| F8  | 80FA011040 | 3FC | 0F20 | 7FB | 00AA | 7FA | 0000 | 0000 | 0101 | F9   |
| F9  | 0020009021 | 3FC | 0F20 | 7FB | 00AA | 7FA | 00AA | 0000 | 0101 | FA   |
| FA  | 0001020001 | 3FC | 0F20 | 7FB | 0154 | 7FA | 00AA | 0000 | 0101 | FB   |
| FB  | 80F7041040 | 3FC | 0F20 | 7FB | 0154 | 7FA | 00AA | 0000 | 0101 | FC   |
| FC  | 0001E09020 | 3FC | 0F20 | 7FB | 00AA | 7FA | 00AA | 0000 | 0000 | FD   |
| FD  | 0088009208 | 3FC | 0F20 | 7F9 | 00AA | 7F9 | 00AA | 0000 | 0000 | FE   |
| FE  | 0200000000 | 3FC | 0F20 | 7F9 | 00AA | 7F9 | 00AA | 0000 | 0000 | FF   |
| FF  | 80C4101040 | 3FC | 0F20 | 7F9 | 00AA | 7F9 | 00AA | 0000 | 0000 | C4   |

##Методика проверки
1.	Загрузить программу с тестами. 
2.	Запустить основную программу с адреса 0x3D1 в режиме работа. 
3.	Дождаться завершения выполнения тестов. 
4.	Проверить значение аккумулятора. Если в аккумуляторе значение 3, то все три теста пройдены успешно.

##Комментарии к методике

• Для проверки правильности работы программы используются следующие значения: 0000 * 0000, FFFF * FFFF и 1055 * 2002.
• Эти значения позволяют убедиться, что программа корректно обрабатывает отрицательные числа, нулевые значения и числа, содержащие старший байт.
• После выполнения каждого теста, результат сравнивается с содержимым ячейки RES. Если они равны, то значение счетчика CHECK увеличивается на 1.
